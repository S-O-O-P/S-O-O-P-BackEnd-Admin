<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.soop.pages.notice.model.dao.NoticeMapper">
    <resultMap id="NoticeResultMap" type="com.soop.pages.notice.model.dto.NoticeMemberFileDTO">
        <id property="noticeCode" column="NOTICE_CODE"/>
        <result property="category" column="CATEGORY"/>
        <result property="title" column="TITLE"/>
        <result property="content" column="CONTENT"/>
        <result property="userCode" column="USER_CODE"/>
        <result property="regDate" column="REG_DATE"/>
        <association property="fileDTO" javaType="com.soop.pages.notice.model.dto.FileDTO">
            <id property="fileCode" column="FILE_CODE"/>
            <result property="name" column="NAME"/>
            <result property="noticeCode" column="NOTICE_CODE"/>
        </association>
    </resultMap>

    <resultMap id="fileResultMap" type="com.soop.pages.notice.model.dto.FileDTO">
        <id property="fileCode" column="FILE_CODE"/>
        <result property="name" column="NAME"/>
        <result property="noticeCode" column="NOTICE_CODE"/>
    </resultMap>



    <select id="getNoticeList" resultMap="NoticeResultMap">
        SELECT
        NOTICE_CODE,
        TITLE,
        REG_DATE,
        USER_CODE
        FROM NOTICE
    </select>

    <insert id="registNotice" parameterType="com.soop.pages.notice.model.dto.NoticeMemberFileDTO" useGeneratedKeys="true" keyProperty="noticeCode">
        INSERT INTO NOTICE
        (
               CATEGORY,
               TITLE,
               CONTENT,
               USER_CODE,
               REG_DATE
        )
        VALUES
        (
               #{category},
               #{title},
               #{content},
               #{userCode},
               #{regDate}
        )
    </insert>

<!--    파일 등록 -->
    <insert id="registNoticeFile" parameterType="com.soop.pages.notice.model.dto.FileDTO">
        INSERT INTO ATTACHED_FILE
        (
               NAME,
               NOTICE_CODE
        )
        VALUES
        (
               #{name},
               #{noticeCode}
        )
    </insert>

    <select id="noticeDetail" resultMap="NoticeResultMap" parameterType="_int">
        SELECT
        A.NOTICE_CODE,
        A.CATEGORY,
        A.TITLE,
        A.CONTENT,
        A.USER_CODE,
        A.REG_DATE,
        B.FILE_CODE,
        B.NAME,
        B.NOTICE_CODE
        FROM NOTICE A
        LEFT JOIN ATTACHED_FILE B ON A.NOTICE_CODE = B.NOTICE_CODE
        WHERE A.NOTICE_CODE = #{id};
    </select>

    <update id="editNotice" parameterType="com.soop.pages.notice.model.dto.NoticeMemberFileDTO">
        UPDATE NOTICE
        SET
        CATEGORY = #{category},
        TITLE = #{title},
        CONTENT = #{content}
        WHERE NOTICE_CODE = #{noticeCode};
    </update>

    <delete id="deleteNotice" parameterType="_int">
        DELETE FROM
               NOTICE
         WHERE NOTICE_CODE = #{id}
    </delete>

</mapper>